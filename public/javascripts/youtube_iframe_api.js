let tag=document.createElement("script"),currentVideo={};const socket=io(origin);let volume=document.querySelector("#volume-control");const video_uri=origin+"/api/v1/video",video_uri_encode=encodeURI(video_uri);tag.src="https://www.youtube.com/iframe_api";let player,previou_volume,firstScriptTag=document.getElementsByTagName("script")[0];async function getCurrentVideo(){const e=await axios({url:video_uri_encode,method:"get"});currentVideo.videoId=e.data.videoId,currentVideo.startAt=e.data.startAt,window.YT.ready(function(){player=new YT.Player("videoframe",{height:"95%",width:"95%",videoId:currentVideo.videoId,playerVars:{playsinline:1,controls:0,autoplay:1,mute:1,start:Math.floor(currentVideo.startAt)},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})})}function onPlayerReady(e){e.target.mute(),e.target.setVolume(0),e.target.playVideo()}function stopVideo(){player.stopVideo()}firstScriptTag.parentNode.insertBefore(tag,firstScriptTag),getCurrentVideo(),socket.on("new_video",e=>{null==player||null==player?window.YT.ready(function(){player=new YT.Player("videoframe",{height:"95%",width:"95%",videoId:e.videoId,playerVars:{playsinline:1,controls:0,autoplay:1,mute:1,start:Math.floor(e.startAt)},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}):player.loadVideoById(e.videoId,e.startAt),document.getElementById(currentVideo.videoId).outerHTML="",currentVideo.videoId=e.videoId}),socket.on("new_listener",e=>{$("#listerns").html(e)});let muteIcon=document.getElementById("muted");document.getElementById("btn-muted").addEventListener("click",()=>{player.isMuted()?(player.unMute(),muteIcon.className="fas fa-volume-up",volume.value=previou_volume||30,player.setVolume(volume.value)):(player.mute(),volume.value=0,muteIcon.className="fas fa-volume-mute")}),volume.addEventListener("change",()=>{player.isMuted()&&player.unMute(),muteIcon.classList.contains("fa-volume-mute")&&(muteIcon.className="fas fa-volume-up"),0==volume.value&&(muteIcon.className="fas fa-volume-mute"),previou_volume=volume.value,player.setVolume(volume.value)});